name: GitHub Actions Demo
run-name: ${{ github.actor }} checking github CI pipeline ðŸš€
on:
  push:
    branches: ["main"]
jobs:
  Docker-Build:
    runs-on: ubuntu-latest 
    steps:
      - run: echo "ðŸŽ‰ The job was automatically triggered by a ${{ github.event_name }} ."
      - name: Check out repository code
        uses: actions/checkout@v5
      - name: Set up Docker Compose
       # This action ensures Docker Compose is installed and available
        uses: docker/setup-compose-action@v2
        with:
          version: 'latest'
      - name: Build Docker Images
        run: docker compose build
      - name: Run Docker Compose services (in detached mode)
      # Brings up all services in the compose file(s) and cleans up afterwards
        uses: hoverkraft-tech/compose-action@v2 # A community action for running compose
        with:
          up-flags: "--build -d" # Pass --build flag to re-build images if needed

      - name: Wait for services to be healthy (optional, but recommended)
      # You might need a specific wait logic depending on service startup times
        run: |
          timeout=180
          counter=0
          until [ "$(docker compose ps -q <service_name> | xargs docker inspect -f '{{.State.Health.Status}}')" == "healthy" ]; do
            if [ $counter -ge $timeout ]; then
              echo "Service <service_name> failed to become healthy within timeout"
              exit 1
            fi
            sleep 5
            counter=$((counter + 5))
          done
      # Replace <service_name> with the actual name of your service in docker-compose.yml
          
